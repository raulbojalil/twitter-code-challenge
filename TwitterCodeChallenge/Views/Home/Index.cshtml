@{ Layout = null; } <!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="apple-mobile-web-app-capable" content="yes" /><meta name="apple-mobile-web-app-title" content="User Home Page"><meta name="mobile-web-app-capable" content="yes" /><meta charset="utf-8"><title>User Home Page</title><meta name="description" content="Code Challenge"><meta name="author" content="Raúl Bojalil"><script type="text/javascript" src="~/Scripts/jquery.min.js"></script>
<script type="text/javascript" src="~/Scripts/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="~/Scripts/bootstrap.min.css"/>
<script type="text/javascript" src="~/Scripts/angular.min.js"></script>
<link rel="stylesheet" type="text/css" href="~/Scripts/bootstrap-datetimepicker.css"/>
<script type="text/javascript" src="~/Scripts/moment-with-locales.js"></script>
<script type="text/javascript" src="~/Scripts/bootstrap-datetimepicker.js"></script>
<script type="text/javascript">var app = angular.module('myApp',[]);
var callAngularFunction = function(element, functionName, params)
{
angular.element(element).scope()[functionName](params);
angular.element(element).scope().$apply();
}
var TWITTER_AVAILABLE = @(ViewBag.TwitterAvailable ? "true" : "false");
var TWITTER_LOGIN_URL = '@Url.Action("TwitterLogin", "Account")';
var TWITTER_SCREEN_NAME = '@(ViewBag.TwitterScreenName)';
var TWITTER_AUTH_HEADER = '@(ViewBag.TwitterAuthorization)';
</script>
<style>.error{color:red}#nav1{margin-bottom:0}#div1{margin-top:69px}</style></head><body ng-app="myApp" id="appCtrl" ng-controller="appCtrl"><form action="@Url.Action("LogOff", "Account")" id="logoutForm" method="post">@Html.AntiForgeryToken()</form><nav class="navbar navbar-default navbar-fixed-top" role="navigation" id="nav1"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapse1" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="navbar-brand">User Home Page</div></div><div class="collapse navbar-collapse" id="collapse1"><ul class="nav navbar-nav navbar-right collapse in"><li class="dropdown open"><a  href="#" title="@ViewBag.Username" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true"><span class="glyphicon glyphicon-user" style="margin-right: 7px"></span><span id="username">@ViewBag.Username</span><b style="margin-left: 10px" class="caret"></b></a><ul class="dropdown-menu"><li ><a id=tab1 title="Sign Out" href="javascript:document.getElementById('logoutForm').submit()"><span class="glyphicon glyphicon-log-out" style="margin-right: 7px"></span>Sign Out</a></li></ul></li></ul></div></div></nav><div class="container-fluid"  id="div1"><div class="row" ng-show="twitterAvailable"><div class="col-sm-12"><div class="panel panel-primary"><div class="panel-heading"><div class="panel-title">My Top 10 Tweets ({{ twitterScreenName }})</div></div><div class="panel-body"><input class="form-control" id="text1" type="text" placeholder="What's happening?" ng-model="newTwitterMsg"/><button ng-disabled="!newTwitterMsg" class="btn btn-info btn-block" ng-click="tweet(newTwitterMsg)">Tweet</button><br/><br/><div class="alert alert-info" ng-show="loadingMyTweets" role="alert"> Loading tweets, please wait...</div><div class="alert alert-danger" ng-show="myTweetsError" role="alert">{{ myTweetsError }}</div><div class="alert alert-info" ng-show="!loadingMyTweets" ng-repeat="tweet in myTweets" role="alert">{{ tweet.text }}</div><div class="alert alert-warning" ng-show="!loadingMyTweets && myTweets.length == 0 && !myTweetsError" role="alert"> No tweets to show</div></div></div></div><div class="col-sm-12"><div class="panel panel-primary"><div class="panel-heading"><div class="panel-title">Top Tweets by Place</div></div><div class="panel-body"><div class="form-group"><label class="control-label" for="text2">Place Id</label><input class="form-control" id="text2" type="text" placeholder="The ID of a twitter place, for example: 5a110d312052166f" ng-model="twitterPlaceId"/></div><button class="btn btn-success btn-block" ng-click="loadPlaceTweets(twitterPlaceId)">Search</button><br/><br/><div class="alert alert-info" ng-show="loadingPlaceTweets" role="alert"> Loading tweets, please wait...</div><div class="alert alert-danger" ng-show="placeTweetsError" role="alert">{{ placeTweetsError }}</div><div class="alert alert-info" ng-show="!loadingPlaceTweets" ng-repeat="tweet in placeTweets" role="alert">{{ tweet.text }}</div><div class="alert alert-warning" ng-show="!loadingPlaceTweets && placeTweets.length == 0 && !placeTweetsError" role="alert"> No tweets to show</div></div></div></div><div class="col-sm-12"><div class="panel panel-primary"><div class="panel-heading"><div class="panel-title">Top Tweets by User and Hashtag</div></div><div class="panel-body"><div class="form-group"><label class="control-label" for="text3">User</label><input class="form-control" id="text3" type="text" placeholder="The Twitter username, for example: realDonaldTrump" ng-model="twitterUser"/></div><div class="form-group"><label class="control-label" for="text4">Hashtag</label><input class="form-control" id="text4" type="text" placeholder="The hashtag without the '#', for example: FlashbackFriday" ng-model="twitterHS"/></div><button class="btn btn-success btn-block" ng-click="loadUserHSTweets(twitterUser, twitterHS)">Search</button><br/><br/><div class="alert alert-info" ng-show="loadingUserHSTweets" role="alert"> Loading tweets, please wait...</div><div class="alert alert-danger" ng-show="userHsTweetsError" role="alert">{{ userHsTweetsError }}</div><div class="alert alert-info" ng-show="!loadingUserHSTweets" ng-repeat="tweet in userHsTweets" role="alert">{{ tweet.text }}</div><div class="alert alert-warning" ng-show="!loadingUserHSTweets && userHsTweets.length == 0 && !userHsTweetsError" role="alert"> No tweets to show</div></div></div></div></div><div class="row" ng-show="!twitterAvailable"><div class="col-sm-12"><button class="btn btn-success btn-block" id="button1">Associate Twitter Account</button></div></div></div><script type="text/javascript">$(".form-modal").each(function(){var a=$(this);a.find("form").data("parent-modal",a)});$(".form-control").each(function(){var b=5;var a=$(this).parent();while(!a.hasClass("form-group")){a=a.parent();b--;if(b==0){break}}$(this).data("form-group",a)});var setFormControlError=function(a){if(!a||!a.data("form-group")){return}a.data("form-group").addClass("has-error")};var clearFormControlError=function(a){if(!a||!a.data("form-group")){return}a.data("form-group").removeClass("has-error")};var getProgress=function(a,b){return Math.floor((a*100)/b)};var validateForm=function(a){var b=true;a.find("input,select,textarea").each(function(){var d=$(this);var c=d.attr("data-required");c=(c=="false"||c=="0"?false:true);if((c&&!d.val()&&d.is(":visible"))||(d.attr("pattern")&&(!(new RegExp(d.attr("pattern")).test(d.val()))))||(d.attr("maxlength")&&d.val().length>parseInt(d.attr("maxlength")))||(d.attr("type")=="email"&&!(/@@/.test(d.val())))){b=false;setFormControlError($(this))}else{clearFormControlError($(this))}});return b};var serializeObject=function(c){var b=c.serializeArray();var e={};for(var d=0;d<b.length;d++){e[b[d].name]=b[d].value}return e};var blockElement=function(c,b,a){if(!c){return}b=b||__defaultLoadingImage;c.each(function(){var d=$(this);d.data("origpos",d.css("position"));d.css("position","relative");var e=$('<div style="z-index: 1000; border: none; margin: 0px; padding: 0px; width: 100%; height: 100%; top: 0px; left: 0px;'+(b?("background-image: url('"+b+"');"):"")+'background-position: center; background-repeat: no-repeat; background-color: rgba(255,255,255,0.7); text-align: center; cursor: wait; position: absolute;"></div>');if(a){e.append(a)}d.append(e);d.data("overlay",e)})};var unblockElement=function(a){if(!a){return}a.each(function(){var b=$(this);if(!b.data("origpos")){return}b.css("position",b.data("origpos"));b.data("overlay").remove()})};var blockWindow=function(b,a){b=b||__defaultLoadingImage;window.__ooverflow=$("body").css("overflow");$("body").css("overflow","hidden");var c=$('<div class="body-block-overlay" style="z-index: 2000; border: none; margin: 0px; padding: 0px; width: 100%; height: 100%; top: 0px; left: 0px;'+(b?("background-image: url('"+b+"');"):"")+'background-position: center; background-repeat: no-repeat; background-color: rgba(255,255,255,0.7); text-align: center; cursor: wait; position: fixed;"></div>');if(a){c.append(a)}$("body").append(c)};var unblockWindow=function(){$("body").css("overflow",window.__ooverflow);$(".body-block-overlay").remove()};var __currentTab=$('[data-toggle="tab"][aria-expanded="true"]');$('a[data-toggle="tab"]').on("shown.bs.tab",function(a){if($(this).data("onStart")){$(this).data("onStart")();$(this).data("onStart",null)}if($(this).data("onLoad")){$(this).data("onLoad")()}if(__currentTab){__currentTab.parent().removeClass("active");__currentTab.parent().parent().parent().removeClass("active")}__currentTab=$(a.target)});function updateQueryStringParam(d,a,e){var b=new RegExp("([?&])"+a+"=.*?(&|$)","i");var c=d.indexOf("?")!==-1?"&":"?";if(d.match(b)){return d.replace(b,"$1"+a+"="+e+"$2")}else{return d+c+a+"="+e}}function getQueryStringParam(d,a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(d);return c===null?null:decodeURIComponent(c[1].replace(/\+/g," "))}$.fn.disable=function(a){if(a){this.attr("_origHtml",this.html()).html(a)}this.each(function(){$(this).attr("disabled","disabled");return this})};$.fn.enable=function(){if(this.attr("_origHtml")){this.html(this.attr("_origHtml"))}this.each(function(){$(this).removeAttr("disabled");return this})};$.fn.ajaxGet=function(c,a,b){this.disable(b);callServerMethod(c,null,function(d){this.enable();a(d)}.bind(this))};$.fn.ajaxPost=function(e,c,b,a,d){this.disable(d);callServerMethod(e,null,function(f){this.enable();a(f)}.bind(this),"POST",c,b)};var __defaultLoadingImage="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQACgABACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkEAAoAAgAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkEAAoAAwAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkEAAoABAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQACgAFACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQACgAGACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAAKAAcALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==";Date.prototype.format=function(e){var g=""+e;if(g.indexOf("dd")!=-1){var a=""+this.getDate();if(a.length==1){a="0"+a}g=g.replace("dd",a)}if(g.indexOf("d'")!=-1){var a=""+this.getDate();g=g.replace("d'",a)}if(g.indexOf("MM")!=-1){var d=""+(this.getMonth()+1);if(d.length==1){d="0"+d}g=g.replace("MM",d)}if(g.indexOf("M'")!=-1){var d=""+(this.getMonth()+1);g=g.replace("M'",d)}g=g.replace("yyyy",this.getFullYear());if(g.indexOf("hh")!=-1){var b=this.getHours();b-=12;if(b==0){b=12}b=""+b;if(b.length==1){b="0"+b}g=g.replace("hh",b)}if(g.indexOf("HH")!=-1){var b=this.getHours();b=""+b;if(b.length==1){b="0"+b}g=g.replace("HH",b)}if(g.indexOf("mm")!=-1){var c=""+this.getMinutes();if(c.length==1){c="0"+c}g=g.replace("mm",c)}if(g.indexOf("ss")!=-1){var f=""+this.getSeconds();if(f.length==1){f="0"+f}g=g.replace("ss",f)}while(g.indexOf("'")>=0){g=g.replace("'","")}return g};var callServerMethod=function(i,d,a,h,c,b){var g=[];if(d){for(var e in d){g.push(e+"="+d[e])}}var f=g.join("&");if(f){f=(i.indexOf("?")==-1?"?":"&")+f}$.ajax({cache:false,url:i+f,data:c||null,type:h||"GET",contentType:b||null,success:function(j,l,k){if(a){a({data:j,textStatus:l,jqXHR:k})}},error:function(l,m,k){var j=k?k:l.responseText;if(window.console){window.console.log("CallServerMethod Error "+i+" "+j)}if(a){a({error:j,textStatus:m,jqXHR:l})}}})};var __searchTimeout=null;$(".grid-search").keyup(function(){clearTimeout(__searchTimeout);__searchTimeout=setTimeout(function(){var a=$(this).closest("[data-source]");a.attr("data-source",updateQueryStringParam(a.attr("data-source"),"search",$(this).val()));refreshDataSource(a)}.bind(this),300)});$("[data-sortable]").each(function(){var d=$(this);var b=d.attr("data-order");b=b||"";if(b){var c=d.closest("[data-source]");var e=c.attr("data-source");var a=d.attr("data-sortable");e=updateQueryStringParam(e,"order",b);e=updateQueryStringParam(e,"sort",a);c.attr("data-source",e)}d.append('<div class="pull-right"><span style="visibility: '+(b=="asc"||b==""?"":"hidden")+'" class="glyphicon glyphicon-triangle-top sort-asc"></span><span style="visibility: '+(b=="desc"||b==""?"":"hidden")+'" class="glyphicon glyphicon-triangle-bottom sort-desc"></span></div>');d.data("order",b)}).click(function(){var d=$(this);var c=d.closest("[data-source]");var a=d.attr("data-sortable");var b=d.data("order");b=((b=="desc")?"asc":"desc");var e=c.attr("data-source");e=updateQueryStringParam(e,"order",b);e=updateQueryStringParam(e,"sort",a);c.attr("data-source",e);c.find(".sort-asc").css("visibility","");c.find(".sort-desc").css("visibility","");c.find("[data-sortable]").data("order","");d.data("order",b);if(b=="desc"){d.find(".sort-asc").css("visibility","hidden");d.find(".sort-desc").css("visibility","")}else{d.find(".sort-asc").css("visibility","");d.find(".sort-desc").css("visibility","hidden")}refreshDataSource(c)});var loadGridData=function(g,f,l){l=l||{};var b=g.find("th").length;var q=g.find("tbody");if(f.error){q.empty().append('<tr class="datagrid-error"><td colspan="'+b+'">ERROR</td></tr>');return}var m=g.find(".pagination");var r=f.data.total;var c=f.data.page;var p=f.data.rows;q.empty();m.empty();var n=getQueryStringParam(g.attr("data-source"),"rows")||10;var a=true;for(var h=0;h<n;h++){a=!a;var s=[];if(h<p.length){var o=p[h];try{if(l.onBeforeRowAdd){o=l.onBeforeRowAdd.bind(g)(p[h])}}catch(f){alert("Error onBeforeRowAdd: "+f);return}s.push('<tr class="datagrid-row '+(a?"datagrid-row-alt":"")+'">');for(var k=0;k<b;k++){if(o.id){s.push("<td>"+o.data[k]+"</td>")}else{s.push("<td>"+o[k]+"</td>")}}s.push("</tr>")}else{s.push('<tr class="datagrid-empty '+(a?"datagrid-row-alt":"datagrid-row")+'"><td colspan="'+b+'">-</td></tr>')}var t=$(s.join(""));t.data("row-data",p[h]);t.click(g,function(i){var j={elem:$(this),data:$(this).data("row-data")};if($(this).hasClass("datagrid-row")){i.data.data("selected-row",j);try{if(l.onRowClick){l.onRowClick.bind($(this))($(this).data("row-data"))}}catch(i){alert("Error onRowClick: "+i);return}}});q.append(t);try{if(l.onRowAdded){l.onRowAdded.bind($(t))(p[h])}}catch(f){alert("Error onRowAdded: "+f);return}}if(m.length>0&&r>0&&p.length>0){m.append('<li class="'+(c=="1"?"disabled":"")+'"><a href="#" data-page="-" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>');m.append('<li class="pagination-first '+(c=="1"?"active":"")+'" style="'+((c>3&&r>7)?"":"display:none")+'"><a data-page="1" href="#"><span aria-hidden="true">1</span></a></li>');m.append('<li class="pagination-showleft" style="'+((c>4&&r>7)?"":"display:none")+'"><a href="#"><span aria-hidden="true">?</span></a></li>');m.find(".pagination-showleft a").click(function(){var v=m.find(".pagination-page a:visible");var e=m.find(".pagination-page");var i=parseInt($(v[0]).attr("data-page"))-1;var j=i-5;if(j<=0){j=0;i=5;m.find(".pagination-showleft").hide();m.find(".pagination-first").hide()}e.hide().slice(j,i).show();m.find(".pagination-showright").show();m.find(".pagination-last").show()});for(var h=0;h<r;h++){var d=Math.abs(c-(h+1));var u="display:none";if(r<=7){u=""}else{if(c<4&&d<6-c){u=""}else{if(c>=4&&d<3&&c<=r-4){u=""}else{if(c>r-4&&d<=c-(r-5)){u=""}}}}m.append('<li style="'+u+'" class="pagination-page '+(h+1==c?"active":"")+'"><a data-page='+(h+1)+' href="#">'+(h+1)+"</a></li>")}m.append('<li class="pagination-showright" style="'+((r>7&&c<=r-4)?"":"display:none")+'"><a href="#"><span aria-hidden="true">?</span></a></li>');m.append('<li class="pagination-last '+(c==r?"active":"")+'" style="'+((r>7&&c<=r-3)?"":"display:none")+'"><a data-page="'+r+'" href="#"><span aria-hidden="true">'+r+"</span></a></li>");m.find(".pagination-showright a").click(function(){var v=m.find(".pagination-page a:visible");var e=m.find(".pagination-page");var j=parseInt($(v[v.length-1]).attr("data-page"));var i=j+5;if(i>=e.length){i=e.length;j=i-5;m.find(".pagination-showright").hide();m.find(".pagination-last").hide()}e.hide().slice(j,i).show();m.find(".pagination-showleft").show();m.find(".pagination-first").show()});m.append('<li class="'+(c==r?"disabled":"")+'"><a href="#" data-page="+" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>');m.find("a[data-page]").click(g,function(w){var i=$(this).attr("data-page");var x=c;if(i=="+"){if(c<r){x=c+1}}else{if(i=="-"){if(c>1){x=c-1}}else{m.find("li").removeClass("active");$(this).parent().addClass("active");x=parseInt(i)}}if(x!=c){try{if(l.onPageChanged){l.onPageChanged.bind(w.data)({current:c,next:x})}}catch(v){alert("Error onPageChanged: "+v);return}var j=w.data.attr("data-source");j=updateQueryStringParam(j,"page",x);j=updateQueryStringParam(j,"rows",n);w.data.data("selected-row",null);w.data.attr("data-source",j);refreshDataSource(w.data)}return false})}else{m.append('<li class="datagrid-noresults">'+l.noresultsLabel?l.noresultsLabel:"</li>")}try{if(l.onDataLoaded){l.onDataLoaded.bind(g)(f.data)}}catch(f){alert("Error onDataLoaded: "+f);return}};$('form[enctype!="multipart/form-data"]').submit(function(){var m=$(this);var l=m.data("parent-modal");var k=l?l.find(".modal-content"):null;var b=m.attr("data-ajax-submit");if(m.data("submitting")){return false}if(typeof _loadingImage==="undefined"){_loadingImage=__defaultLoadingImage}if(m.attr("data-block-image")){m.data("block-image",m.attr("data-block-image"))}else{m.data("block-image",_loadingImage)}if(m.attr("data-block-element")){m.data("block-element",$(m.attr("data-block-element")))}else{m.data("block-element",k?k:m)}if(!m.is("[novalidate]")){var h=m.data("invalid");if(!validateForm(m)){if(h){h()}return false}}if(!m.attr("action")){return false}var j=m.attr("method");var e=m.attr("enctype");j=j||"POST";e=e||"application/x-www-form-urlencoded";var f;var i=false;if(b){if(e=="application/json"||e=="text/json"){i=true;f=serializeObject(m)}else{f=m.serialize()}}var d=true;var c=m.data("beforeSubmit");if(c){try{d=c(b?f:serializeObject(m))}catch(g){alert("Error beforeSubmit: "+g)}}if(d===undefined){d=true}if(d){m.data("submitting",true);m.find("input,select,textarea").attr("readonly","readonly");blockElement(m.data("block-element"),m.data("block-image"));if(l){l.find(".server-error-message").remove()}if(!b){return true}var a=m.attr("action");callServerMethod(a,null,function(o){var q=$(this);unblockElement(q.data("block-element"));q.find("input,select,textarea").removeAttr("readonly");q.data("submitting",false);if(l){if(o.error){l.find(".modal-body").append('<div class="server-error-message alert alert-danger">'+(o.jqXHR.responseText?o.jqXHR.responseText:o.error)+"</div>")}else{l.modal("hide")}}if(!o.error){refreshDataSource($('[data-source="'+a+'"]'));q[0].reset()}var n=q.data("afterSubmit");if(n){try{n(o)}catch(p){alert("Error afterSubmit: "+p)}}}.bind(this),j,i?JSON.stringify(f):f,e)}return false});var setElementValue=function(elem,val){var isArray=$.isArray(val);if(elem.attr("data-dateformat")){val=new Date(val).format(elem.attr("data-dateformat"))}if(elem.attr("data-format")){val=eval("var value = '"+val+"';"+elem.attr("data-format"))}if(elem.is("select")){if(isArray){elem.empty();for(var i=0;i<val.length;i++){if($.isPlainObject(val[i])){elem.append('<option value="'+val[i].value+'">'+val[i].text+"</option>")}else{elem.append("<option>"+val[i]+"</option>")}}}else{elem.val(val)}}else{if(elem.is("input")){var type=elem.attr("type");if(type=="checkbox"||type=="radio"){elem.prop("checked",val?true:false)}else{elem.val(($.isPlainObject(val)?JSON.stringify(val):val))}}else{if(elem.is("textarea")){if(isArray){elem.val(val.join("\n"))}else{elem.val(($.isPlainObject(val)?JSON.stringify(val):val))}}else{elem.html(isArray?val.join("</br>"):($.isPlainObject(val)?JSON.stringify(val):val))}}}};var updateDataSource=function(b,c){var a=b.attr("data-source");if(!a){return}if(c){for(var d in c){a=updateQueryStringParam(a,d,c[d])}b.attr("data-source",a)}};var ___rowHtmls={};var refreshDataSource=function(elem,newParams,callback){var dataSource=elem.attr("data-source");if(!dataSource){return}try{dataSource=eval(dataSource)}catch(e){}if(newParams){for(var prop in newParams){dataSource=updateQueryStringParam(dataSource,prop,newParams[prop])}elem.attr("data-source",dataSource)}if(elem.data("submitting")){return false}if(typeof _loadingImage==="undefined"){_loadingImage=__defaultLoadingImage}if(elem.attr("data-block-image")){elem.data("block-image",elem.attr("data-block-image"))}else{elem.data("block-image",_loadingImage)}if(elem.attr("data-block-element")){elem.data("block-element",$(elem.attr("data-block-element")))}else{elem.data("block-element",elem)}var beforeLoad=elem.data("beforeLoad");if(beforeLoad){try{beforeLoad()}catch(ex){alert("Error beforeLoad: "+ex)}}elem.data("submitting",true);blockElement(elem.data("block-element"),elem.data("block-image"));$('[data-source-id="'+elem.attr("id")+'"][data-bind]').each(function(){var self=$(this);self.attr("disabled","disabled").removeClass("error")});callServerMethod(dataSource,null,function(e){var self=$(this);e.elem=self;unblockElement(self.data("block-element"));self.data("submitting",false);var error=e.error?(e.jqXHR.responseText?e.jqXHR.responseText:e.error):null;if(!error){if(!$.isArray(e.data)){$('[data-source-id="'+self.attr("id")+'"][data-bind]').each(function(){var self=$(this);var dataBind=self.attr("data-bind");var v=dataBind?e.data[dataBind]:e.data;if(v===undefined){v=""}setElementValue(self.removeAttr("disabled"),v)})}else{if(self.is("select")){setElementValue(self.removeAttr("disabled"),e.data)}else{var row=$('[data-source-id="'+self.attr("id")+'"][data-bind]');var rowHtml="";var parentTable="";if(row.length>0){if(row.attr("data-bind")){row=$(row[0]).parent()}else{row=$(row[0])}rowHtml=$("<div></div>").append(row.clone()).html();parentTable=row.parent();___rowHtmls[self.attr("id")]={rowHtml:rowHtml,parentTable:parentTable}}if(___rowHtmls[self.attr("id")]){parentTable=___rowHtmls[self.attr("id")].parentTable;rowHtml=___rowHtmls[self.attr("id")].rowHtml}if(parentTable&&rowHtml){parentTable.empty();for(var i=0;i<e.data.length;i++){var newRow=$(rowHtml);newRow.find('[data-source-id="'+self.attr("id")+'"][data-bind]').each(function(){var self=$(this);var dataBind=self.attr("data-bind");var v=dataBind?e.data[i][dataBind]:e.data[i];if(v===undefined){v=""}setElementValue(self.removeAttr("disabled"),v)});newRow.find('[data-source-id="'+self.attr("id")+'"][data-bind-click]').each(function(){var clickableElement=$(this);clickableElement.click(e.data[i],function(ev){eval("var data = "+JSON.stringify(ev.data)+";"+clickableElement.attr("data-bind-click"))})});newRow.find('[data-source-id="'+self.attr("id")+'"][data-bind-change]').each(function(){var clickableElement=$(this);clickableElement.change(e.data[i],function(ev){eval("var data = "+JSON.stringify(ev.data)+";"+clickableElement.attr("data-bind-change"))})});parentTable.append(newRow)}}}}}if(error){$('[data-source-id="'+self.attr("id")+'"][data-bind]').each(function(){var self=$(this);setElementValue(self.addClass("error"),error)})}var afterLoad=self.data("afterLoad");if(afterLoad){try{afterLoad(e)}catch(ex){alert("Error afterLoad: "+ex)}}if(callback){callback(e)}}.bind(elem),elem.attr("data-method")?elem.attr("data-method"):"GET")};$('a[data-toggle="tab"]').click(function(a){if(a.originalEvent!==undefined&&window.history&&window.history.pushState){var b=$(this).attr("href");window.history.pushState(b,"",b)}setTimeout(function(){var c=$(this);$(c.attr("href")).find("[data-source]").each(function(e){var d=$(this);if(d.is(":visible")){refreshDataSource(d)}});if(c.attr("data-source")){refreshDataSource(c)}}.bind(this),200)});window.onpopstate=function(a){$('a[href="'+a.state+'"]').click()};$("ul.submenu a").on("shown.bs.tab",function(){$(this).parent().parent().closest("li").addClass("active")});app.controller("appCtrl",["$scope","$timeout","$http",function(b,c,a){if(TWITTER_AUTH_HEADER){a.defaults.headers.common["X-TWITTERAUTH"]=TWITTER_AUTH_HEADER}b.twitterAvailable=TWITTER_AVAILABLE;b.twitterScreenName=TWITTER_SCREEN_NAME;b.myTweetsError="";b.myTweets=[];b.loadMyTweets=function(){b.myTweetsError="";b.loadingMyTweets=true;a({url:"/api/tweets",method:"GET",}).then(function(d){b.loadingMyTweets=false;b.myTweets=d.data},function(d){b.loadingMyTweets=false;b.myTweetsError="An error has ocurred please try again later"})};b.loadMyTweets();b.placeTweetsError="";b.placeTweets=[];b.loadPlaceTweets=function(d){b.placeTweetsError="";b.loadingPlaceTweets=true;a({url:"/api/tweets?place="+d,method:"GET",}).then(function(e){b.loadingPlaceTweets=false;b.placeTweets=e.data.statuses},function(e){b.loadingPlaceTweets=false;b.placeTweetsError="An error has ocurred please try again later"})};b.userHsTweets=[];b.userHsTweetsError="";b.loadUserHSTweets=function(e,d){b.userHsTweetsError="";b.loadingUserHSTweets=true;a({url:"/api/tweets?user="+e+"&hashtag="+d,method:"GET",}).then(function(f){b.loadingUserHSTweets=false;b.userHsTweets=f.data.statuses},function(f){b.loadingUserHSTweets=false;b.userHsTweetsError="An error has ocurred please try again later"})};b.tweet=function(d){if(!d){return}b.loadingUserHSTweets=true;a({url:"/api/tweets?status="+d,method:"POST",}).then(function(e){b.loadMyTweets();b.newTwitterMsg=""},function(e){alert("An error ocurred while adding your new tweet, please try again later")})}}]);$("#button1").click(function(a){window.location=TWITTER_LOGIN_URL});var __hash=window.location.hash;var __hashTab=__hash?$('a[href="'+__hash+'"]'):null;if(__hashTab==null||__hashTab.length==0){__hashTab=$('a[data-toggle="tab"][aria-expanded="true"]:first');if(__hashTab.length>0){__hash=__hashTab.attr("href")}}if(window.history&&window.history.pushState&&__hash){window.history.pushState(__hash,"",__hash)}if(__hashTab!=null&&__hashTab.length>0){__hashTab.click();if(__hashTab.data("onStart")){__hashTab.data("onStart")()}}else{$("[data-source]").each(function(b){var a=$(this);if(a.is(":visible")){if(!a.attr("data-toggle")){refreshDataSource(a)}}})};</script></body></html>